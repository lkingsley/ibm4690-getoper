STRING ARGS$, INDICATS$, NAME$, OPERATOR$, OPTIONS$, PASSWD$
STRING RECORD.FORMAT$, USER.EXIT$
INTEGER*4 IO.SESSION%, KEY.LENGTH%, RECORD.LENGTH%
INTEGER*4 ERRNCODE%, HX%, S%, SX%, THE.SUM%
STRING ERRFX$, Z$

ARGS$ = COMMAND$
FILE.NAME$ = "EAMOPERA"
ID.REQUIRED$ = "Operator ID required!"
IO.SESSION% = 10
KEY.LENGTH% = 10
OPERATOR.NOT.FOUND$ = "Operator not found."
RECORD.LENGTH% = 72
RECORD.FORMAT$ = "C5,C4,C1,C22,C20,C20"


ON ERROR GOTO ERRORTRAP
OPEN FILE.NAME$ KEYED RECL RECORD.LENGTH% AS IO.SESSION%

IF LEN(ARGS$) = 0 THEN \
    BEGIN 
        PRINT ID.REQUIRED$
        GOTO FINISH
    ENDIF

!* FILLING STRING WITH LEADING ZEROS *!
IF LEN(ARGS$) < KEY.LENGTH% THEN \
    ARGS$ = STRING$(KEY.LENGTH% - LEN(ARGS$), "0")+ ARGS$

READ FORM RECORD.FORMAT$; #IO.SESSION% KEY PACK$( \
    ARGS$);OPERATOR$, PASSWD$, OPTIONS$, INDICATS$, NAME$, USER.EXIT$

PRINT "OPERATOR: ";UNPACK$(OPERATOR$)
PRINT "PASSWD: ";UNPACK$(PASSWD$)
PRINT "OPERNAME: ";NAME$
PRINT "OPTIONS: ";UNPACK$(OPTIONS$)
PRINT "USEREXIT: ";USER.EXIT$

CLOSE IO.SESSION%

FINISH:
STOP

ERRORTRAP:
!* ERROR ASSEMBLY ROUTINE *!
HX% = ERRN
ERRFX$ = ""
FOR S% = 28 TO 0 STEP -4
    SX% = SHIFT(HX%,S%)
    THE.SUM% = SX% AND 000FH
IF THE.SUM% > 9 THEN    \
    THE.SUM%=THE.SUM%+55 \
ELSE                    \
    THE.SUM%=THE.SUM%+48
    Z$=CHR$(THE.SUM%)
    ERRFX$ = ERRFX$ + Z$
NEXT S%

IF ERRFX$ = "0000001C" THEN \
    BEGIN
        PRINT OPERATOR.NOT.FOUND$
    ENDIF \
ELSE \
    BEGIN
        PRINT
        PRINT "A runtime error has occurred"
        PRINT
        PRINT "  ERR = ";ERR,"   ERRL = ";ERRL
        PRINT "  ERRF = ";ERRF%,"   ERRN = ";ERRFX$
        PRINT
    ENDIF
END